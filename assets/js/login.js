// Generated by CoffeeScript 1.4.0
(function() {

  Hive.LoginHandler = function() {};

  Hive.LoginHandler.prototype = {
    initialize: function(container) {
      console.log(container);
      this.container = container;
      this.form = container.find('form');
      this.text_field = container.find('input#api_key');
      this.submit = container.find('input[type=submit]');
      return this.bindForm();
    },
    bindForm: function() {
      var self;
      self = this;
      return this.form.submit(function(event) {
        event.preventDefault();
        self.callApi();
        return false;
      });
    },
    callApi: function() {
      var key;
      key = this.text_field.val();
      return $.ajax({
        url: 'https://agilezen.com/api/v1/me',
        dataType: 'JSON',
        headers: {
          'X-Zen-ApiKey': key
        },
        error: function(xhr, status, error) {
          console.log(status);
          return console.log(xhr);
        },
        success: function(data, status, xhr) {
          console.log(status);
          console.log(data);
          localStorage['api_key'] = key;
          return Hive.start();
        }
      });
    },
    render: function() {
      var container;
      container = Hive.Templates.loginHandler();
      $('section#main').hide().html(container).fadeIn(1500);
      return this.initialize($('div#login'));
    }
  };

}).call(this);
