// Generated by CoffeeScript 1.4.0
(function() {
  var root;

  require(['jquery', 'controller', 'views', 'ui', 'login', 'user', 'projects', 'stories'], function($) {
    return jQuery(function() {
      return Hive.start();
    });
  });

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  root.Hive = {
    data: {},
    start: function() {
      var loginHandler, userHandler;
      console.log("START!");
      if (localStorage['api_key'] != null) {
        console.log("CONTINUE!");
        $.ajaxSetup({
          dataType: 'JSON',
          headers: {
            'X-Zen-ApiKey': localStorage['api_key']
          }
        });
        userHandler = new Hive.UserHandler;
        return Hive.Controller.load();
      } else {
        console.log("PROMPT!");
        return loginHandler = new Hive.LoginHandler;
      }
    },
    login: function(key, user) {
      console.log("LOGIN!");
      localStorage['api_key'] = key;
      Hive.data.user = user;
      return Hive.start();
    },
    logout: function() {
      console.log("LOGOUT!");
      localStorage.removeItem('api_key');
      this.data = {};
      return Hive.start();
    },
    resource: function(name) {
      return "https://agilezen.com/api/v1/" + name;
    },
    getData: function(name, callback) {
      if (Hive.data[name] != null) {
        return callback(Hive.data[name]);
      } else {
        return $.ajax({
          url: Hive.resource(name),
          async: false,
          error: function(xhr, status, error) {},
          success: function(data, status, error) {
            Hive.data[name] = data;
            if (callback != null) {
              return callback(data);
            }
          }
        });
      }
    },
    setData: function(name, data, callback) {
      console.log("send data");
      console.log(data);
      return $.ajax({
        url: Hive.resource(name),
        async: false,
        contentType: 'application/json',
        type: 'PUT',
        data: JSON.stringify(data),
        dataType: 'text',
        error: function(xhr, status, error) {
          console.log(xhr);
          console.log(status);
          return console.log(error);
        },
        success: function(response, status, error) {
          Hive.data[name] = response;
          if (callback != null) {
            return callback(response);
          }
        }
      });
    },
    setMessage: function(message) {
      var element;
      element = Hive.Views.statusMessage(message);
      return Hive.Controller.setViewport('toolbar', element);
    }
  };

}).call(this);
